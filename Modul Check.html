<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Check - Modules</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0f3d3e;       
            --bg-darker: #0a2b2c;     
            --accent-lime: #d4e157;   
            --body-bg: #f4fcf7;       
            --text-dark: #1b4d3e;
            --white: #ffffff;
            --grey-text: #666666;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--body-bg);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* HEADER */
        .header-section {
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            padding: 30px 20px 40px 20px;
            color: white;
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
            box-shadow: 0 10px 30px rgba(15, 61, 62, 0.3);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .back-btn {
            position: absolute; top: 30px; left: 20px;
            color: white; font-size: 1.2rem; cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s;
        }
        .back-btn:active { transform: scale(0.9); }

        .header-title h1 { font-size: 1.8rem; font-weight: 800; color: var(--white); margin: 0; }
        .header-title p { font-size: 0.85rem; color: var(--accent-lime); opacity: 0.9; margin-top: 5px; }

        /* CONTENT CONTAINER */
        .content-container { padding: 30px 20px; margin-top: -20px; z-index: 20; }

        /* LABEL SECTION */
        .section-label {
            font-size: 0.9rem; font-weight: 700; color: var(--bg-dark);
            margin-bottom: 15px; display: flex; align-items: center; gap: 8px;
        }
        .section-label::after { content: ''; flex: 1; height: 1px; background: #ddd; }

        /* GRID MENU */
        .grid-menu {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px 15px;
        }

        .grid-item {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            text-decoration: none; color: var(--text-dark); cursor: pointer;
            transition: transform 0.2s; position: relative; /* Penting untuk posisi lock */
        }
        .grid-item:active { transform: scale(0.95); }

        .grid-icon {
            width: 55px; height: 55px; border-radius: 18px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; background: #ffffff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            color: var(--bg-dark); transition: 0.2s;
            position: relative;
        }
        
        .week-badge {
            position: absolute; top: -5px; right: -5px;
            background: var(--bg-dark); color: var(--accent-lime);
            font-size: 0.6rem; padding: 2px 5px; border-radius: 10px;
            font-weight: 700; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            min-width: 24px; text-align: center;
        }

        .grid-text {
            font-size: 0.75rem; text-align: center; font-weight: 600;
            color: #444; line-height: 1.2;
        }

        /* WARNA ICON */
        .icon-lime { color: #afb42b; background: #f9fbe7; }
        .icon-green { color: #2e7d32; background: #e8f5e9; }
        .icon-blue { color: #0277bd; background: #e1f5fe; }
        .icon-orange { color: #ef6c00; background: #fff3e0; }
        .icon-teal { color: #00897b; background: #e0f2f1; }
        .icon-pink { color: #d81b60; background: #fce4ec; }
        .icon-purple { color: #7b1fa2; background: #f3e5f5; }
        .icon-red { color: #c62828; background: #ffebee; }

        /* --- FITUR LOCK (Sama seperti Dashboard) --- */
        .tutor-lock-btn {
            position: absolute; top: -8px; left: 0; /* Posisi di kiri atas ikon */
            width: 24px; height: 24px; background: white; border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 15;
            display: none; /* Muncul lewat JS jika Tutor */
            justify-content: center; align-items: center; font-size: 0.7rem; color: #aaa;
            transition: 0.2s;
        }
        .tutor-lock-btn:hover { transform: scale(1.1); }
        .tutor-lock-btn.locked { color: #e53935; border: 1px solid #e53935; }

        /* State ketika Item Terkunci (Untuk Student) */
        .item-locked { opacity: 0.6; filter: grayscale(0.8); }
        .lock-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center;
            z-index: 5; border-radius: 18px;
        }
        /* Lock icon besar untuk student */
        .item-locked .lock-overlay { display: flex; }
        .lock-icon-large {
            font-size: 1.5rem; color: #555; background: rgba(255,255,255,0.9);
            padding: 8px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Animasi Masuk */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .grid-item { opacity: 0; animation: fadeInUp 0.4s forwards; }
        .grid-item:nth-child(1) { animation-delay: 0.05s; }
        .grid-item:nth-child(2) { animation-delay: 0.1s; }
        .grid-item:nth-child(3) { animation-delay: 0.15s; }
        .grid-item:nth-child(4) { animation-delay: 0.2s; }
        .grid-item:nth-child(5) { animation-delay: 0.25s; }
        .grid-item:nth-child(6) { animation-delay: 0.3s; }
        .grid-item:nth-child(7) { animation-delay: 0.35s; }
        .grid-item:nth-child(8) { animation-delay: 0.4s; }

    </style>
</head>
<body>

    <div class="header-section">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
        <div class="header-title">
            <h1>Modul Check</h1>
            <p>8 Weeks to Mastery</p>
        </div>
    </div>

    <div class="content-container">
        
        <div class="section-label">Foundation (Week 1-4)</div>
        <div class="grid-menu" style="margin-bottom: 25px;">
            
            <div class="grid-item" id="m_week1" onclick="handleModuleClick('POS.html', 'm_week1')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week1')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-lime">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W1</span>
                    üèõÔ∏è
                </div>
                <div class="grid-text">POS</div>
            </div>

            <div class="grid-item" id="m_week2" onclick="handleModuleClick('phrase.html', 'm_week2')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week2')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-green">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W2</span>
                    üß©
                </div>
                <div class="grid-text">Phrase</div>
            </div>

            <div class="grid-item" id="m_week3" onclick="handleModuleClick('circle.html', 'm_week3')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week3')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-blue">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W3</span>
                    ‚≠ï
                </div>
                <div class="grid-text">Circle</div>
            </div>

            <div class="grid-item" id="m_week4" onclick="handleModuleClick('sentence.html', 'm_week4')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week4')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-orange">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W4</span>
                    üìù
                </div>
                <div class="grid-text">Sentence</div>
            </div>
        </div>

        <div class="section-label">Structure (Week 5-8)</div>
        <div class="grid-menu">
            
            <div class="grid-item" id="m_week5" onclick="handleModuleClick('tenses 1.html', 'm_week5')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week5')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-teal">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W5</span>
                    üïê
                </div>
                <div class="grid-text">Tenses 1</div>
            </div>

            <div class="grid-item" id="m_week6" onclick="handleModuleClick('tenses 2.html', 'm_week6')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week6')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-pink">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W6</span>
                    ‚è≥
                </div>
                <div class="grid-text">Tenses 2</div>
            </div>

            <div class="grid-item" id="m_week7" onclick="handleModuleClick('TENSES 3.html', 'm_week7')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week7')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-purple">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W7</span>
                    üîÑ
                </div>
                <div class="grid-text">Tenses 3</div>
            </div>

            <div class="grid-item" id="m_week8" onclick="handleModuleClick('clause.html', 'm_week8')">
                <div class="tutor-lock-btn" onclick="event.stopPropagation(); toggleLock('m_week8')"><i class="fas fa-lock"></i></div>
                <div class="grid-icon icon-red">
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon-large"></i></div>
                    <span class="week-badge">W8</span>
                    üîó
                </div>
                <div class="grid-text">Clause</div>
            </div>

        </div>
    </div>

    <audio id="hoverSound">
        <source src="data:audio/mp3;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG84n418AAoAA IVRE2AAAPHzeP//4f/4D/wT/wn/4X/8J//4f/5/w/4T0/w/4f/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9/4T/9//4f/9" type="audio/mpeg">
    </audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        // --- PASTE FIREBASE CONFIG ANDA DISINI ---
       const firebaseConfig = {
  apiKey: "AIzaSyAgYCaaoGMzZWVT2dRov7ALUnnMhHoqXmE",
  authDomain: "english-check-db.firebaseapp.com",
  databaseURL: "https://english-check-db-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "english-check-db",
  storageBucket: "english-check-db.firebasestorage.app",
  messagingSenderId: "136352630898",
  appId: "1:136352630898:web:dcaa103fa848ca38de9aeb"
};
        // ----------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- LOCK SYSTEM LOGIC ---
        let lockedModules = {};

        // Toggle Lock (Tutor Only)
        window.toggleLock = function(moduleId) {
            const isLocked = lockedModules[moduleId] || false;
            set(ref(db, 'locks/' + moduleId), !isLocked).catch((err) => console.error(err));
        };

        // Listen for changes
        onValue(ref(db, 'locks'), (snapshot) => {
            if (snapshot.exists()) {
                lockedModules = snapshot.val();
            } else {
                lockedModules = {};
            }
            updateLockUI();
        });

        // Update UI based on Role & Lock State
        function updateLockUI() {
            const isTutor = localStorage.getItem('ec_role') === 'tutor';
            const modules = ['m_week1', 'm_week2', 'm_week3', 'm_week4', 'm_week5', 'm_week6', 'm_week7', 'm_week8'];

            modules.forEach(id => {
                const isLocked = lockedModules[id] === true;
                const lockBtn = document.querySelector(`#${id} .tutor-lock-btn`);
                const itemDiv = document.getElementById(id);

                // 1. Tampilkan tombol lock hanya untuk Tutor
                if(lockBtn) {
                    lockBtn.style.display = isTutor ? 'flex' : 'none';
                    if(isLocked) {
                        lockBtn.innerHTML = '<i class="fas fa-lock"></i>';
                        lockBtn.classList.add('locked');
                    } else {
                        lockBtn.innerHTML = '<i class="fas fa-lock-open"></i>';
                        lockBtn.classList.remove('locked');
                    }
                }

                // 2. Efek Visual untuk Student jika dikunci
                if(isLocked && !isTutor) {
                    if(itemDiv) itemDiv.classList.add('item-locked');
                } else {
                    if(itemDiv) itemDiv.classList.remove('item-locked');
                }
            });
        }

        // --- HANDLE CLICK (NAVIGATION CHECK) ---
        window.handleModuleClick = function(targetUrl, moduleId) {
            const isTutor = localStorage.getItem('ec_role') === 'tutor';
            const isLocked = lockedModules[moduleId] === true;

            // Efek suara
            playSound();

            // Tutor bebas akses
            if (isTutor) {
                setTimeout(() => { window.location.href = targetUrl; }, 200);
                return;
            }

            // Student dicek dulu
            if (isLocked) {
                alert("üîí Maaf, materi minggu ini belum dibuka oleh Tutor.");
            } else {
                setTimeout(() => { window.location.href = targetUrl; }, 200);
            }
        };

        // Panggil update saat load (in case role belum terbaca di awal)
        window.onload = function() {
            updateLockUI();
        }
    </script>

    <script>
        // --- SOUND EFFECT LOGIC ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound() {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(400, audioCtx.currentTime); 
            oscillator.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.1); 

            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); 
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); 

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }
    </script>

</body>
</html>